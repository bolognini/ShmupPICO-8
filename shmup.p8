pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
function _init()
	t=0

	ship = {
		sp=1,
		x=60,
		y=100,
		h=4,
		p=0,
		t=0,
		shipx=64,
		shipy=64,
		shipsize=3,
		shipxdir=5,
		shipydir=-3,
		imm=false,
		box = {x1=0,y1=0,x2=7,y2=7}}
	bullets = {}
	enemies = {
	sp=17 or 18
	}
	explosions = {}
	stars = {}
	
	for i=1,128 do
		add(stars,{
			x=rnd(128),
			y=rnd(128),
			s=rnd(2)+1
		})
	end
	
	
	start()
end

function respawn()
sfx(1)
	local n = flr(rnd(9))+2
	for i=1,n do
		local d = -1
		if rnd(1)<0.5 then d=1 end
	add(enemies, {
		sp=enemies.sp,
		m_x=i*16,
		m_y=60-i*8,
		d=d,
		x=-32,
		y=-32,
		r=12,
		box = {x1=0,y1=0,x2=7,y2=7}
	})
	end
	


function shipcollide()
	--left
	 if shipx<shipsize then
	 shipxdir=-shipxdir
		end
	
	--right
		if shipx>128-shipsize then
		shipxdir=-shipxdir
		end
	
	--top
		if shipy<shipsize then
		shipydir=-shipydir
		end
	end


end

function start()
	_update = update_game
	_draw = draw_game
end

function game_over()
	_update = update_over
	_draw = draw_over
	sfx(2)
end

function update_over()

end

function draw_over()
	cls()
	print("game over",40,50,4)
end

function abs_box(s)
	local box = {}
	box.x1 = s.box.x1 + s.x
	box.y1 = s.box.y1 + s.y
	box.x2 = s.box.x2 + s.x
	box.y2 = s.box.y2 + s.y
	return box
end

function coll(a,b)
	local box_a = abs_box(a)
	local box_b = abs_box(b)
	
	if box_a.x1 > box_b.x2 or
				box_a.y1 > box_b.y2 or
				box_b.x1 > box_a.x2 or
				box_b.y1 > box_a.y2 then
				return false
	end
	
	return true
end

function explode(x,y)
	add(explosions,{x=x,y=y,t=0})
	sfx(3)

end

function fire()
	local b = {
		sp=4,
 	x=ship.x,
 	y=ship.y,
		dx=0,
		dy=-3,
		box = {x1=2,y1=0,x2=5,y2=4}
	}
	add(bullets,b)
end

function update_game()
	t=t+1
	if ship.imm then
		ship.t += 1
		if ship.t >30 then
			ship.imm = false
			ship.t = 0
		end
	end
	
	for st in all(stars) do
		st.y += st.s
		if st.y >= 128 then
			st.y = 0
			st.x=rnd(128)
		end
	end
	
	for ex in all(explosions) do
		ex.t+=1
		if ex.t==13 then
			del(explosions,ex)
		end
	end
	
	if #enemies <= 0 then
		respawn()
	end
	
	for e in all(enemies) do
	e.m_y += 1.3
		e.x = e.r*sin(e.d*t/200) + e.m_x
		e.y = e.r*cos(t/200) + e.m_y
		if coll(ship,e) and not ship.imm then
			ship.imm = true
			ship.h -= 1
			sfx(4)
			if ship.h <= 0 then
				game_over()
			end
			
		end
		
		if e.y >= 150 then
			del(enemies,e)
		end
		
	end
	
	for b in all(bullets) do
		b.x+=b.dx
		b.y+=b.dy
		if b.x < 0 or b.x > 128 or
			b.y < 0 or b.y > 128 then
			del(bullets,b)
		end
		for e in all(enemies) do
			if coll(b,e) then
				del(enemies,e)
				ship.p += 1
				explode(e.x,e.y)
			end
		end
	end
	
	if(t%6<3) then
		ship.sp=2
	else
		ship.sp=3
	end
	
	if(t%6<3) then
		enemies.sp=17
	else
		enemies.sp=18
	end
	
	if btn(⬅️) then ship.x-=2 end
	if btn(➡️) then ship.x+=2 end
	if btn(⬆️) then ship.y-=2 end
	if btn(⬇️) then ship.y+=2 end
	if btnp(🅾️) then fire() sfx(0)
	end
end

function draw_game()
		cls()
	for st in all(stars) do
		pset(st.x,st.y,6)
	end
	print(ship.p,9)
	if not ship.imm or t%8 < 4 then
		spr(ship.sp,ship.x,ship.y)
	end
	
	for ex in all(explosions) do
		circ(ex.x,ex.y,ex.t/3,8+ex.t%3)
	end
	for b in all(bullets) do
		spr(b.sp,b.x,b.y)
	end
	
	for e in all(enemies) do
	spr(e.sp,e.x,e.y)
	end
	
	for i=1,4 do
		if i<=ship.h then
			spr(33,80+6*i,3)
			else
			spr(34,80+6*i,3)
		end
	end
end
__gfx__
0000000000000000000dd000000dd000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000dd000005555000055550000a9a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700005555000555555005555550000900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700005555550d551155dd551155d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000d551155dd505505dd505505d000900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700d505505d000aa000000aa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000aa0000009000000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000900000090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000200000020100001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000220000220120021000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000222112220110011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000222222221111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000023333201113311100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000022332201011110100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000002222000001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000110000002200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000080800000606000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000888880006666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000088800000666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000008000000060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
0002000038350373502f3502d35028350203501b350183500e3500b35002350013500000005300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000300003f7503c7503a750367503475033750307502e7502d7502a750287502575022750217501e7501e7501b7501775016750157501375011750107500f7500d7500b7500a7500875005750047500375002750
00100000303502e3502e3502d3502e3502f35030350313503135031350303502c3502a35024350223501c35019350133500d35007350013500000000000000000000000000000000000000000000000000000000
000200003f6503c6503a6503765033650306502d650296502665021650206501a65016650136500d6500965005650016500000000000000000000000000000000000000000000000000000000000000000000000
000200001a75018750157501375012750107500e7500d7500c7500b7500b7500a75009750087500775005750057500475004750047500375003750027500275002750017500475002750017501d7001b7001a700
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__music__
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000

